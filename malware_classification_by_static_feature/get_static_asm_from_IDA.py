import os

def get_all_files(rootdir):
    files = []
    list = os.listdir(rootdir)  # 列出文件夹下所有的目录与文件
    for i in range(0, len(list)):
        path = os.path.join(rootdir, list[i])
        if os.path.isdir(path):
            files.extend(get_all_files(path))
        if os.path.isfile(path):
            files.append(path)
    return files

#删除非exe文件生成的asm文件
def delete_notexe_asm_file(filename):
    flag=0
    with open(filename,encoding='utf-8') as f:
        for line in f:
            line=line.strip().split(" ")
            print(line[0])
            s= str(line[0].strip())
            s2=str("//")
            if s == s2:
                flag=1
            break
    f.close()
    if flag==1:
        print("hhh")
        os.remove(filename)


if __name__== "__main__":
    dir="E:\\PE_dataset\\backdoors\\tmp"#backdoors\rootkits\spywares\trojans\worms
    file_list=get_all_files(dir)
    for file in file_list:
        print(file)
        #反汇编文件
        command = 'D:\\IDA7.0\\idat.exe -B ' + file
        os.system(command)

    # dir="D:\\PE_asm_file\\2\\"
    # file_list = get_all_files(dir)
    # for file in file_list:
    #     print(file)
    #     delete_notexe_asm_file(file)


